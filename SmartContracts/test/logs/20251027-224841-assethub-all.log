

  AssetHubVault Testnet - Configuration Check

ğŸ”— Connecting to AssetHubVault at: 0x67E5293e374219C515bD9838B23C792C555e51D4
âœ… Successfully connected to contract

    Contract Deployment
      âœ” should be deployed at correct address
      âœ” should respond to function calls
    Role Configuration
   Admin: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
      âœ” should have admin configured (40ms)
   Operator: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
      âœ” should have operator configured (59ms)
   Emergency: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
      âœ” should have emergency address configured
    XCM Configuration
   XCM Precompile: 0x00000000000000000000000000000000000a0000
      âœ” should have XCM precompile set (124ms)
   XCM Frozen: false
      âœ” should check if XCM precompile is frozen (127ms)
    Contract State
   Paused: false
      âœ” should check if contract is paused (51ms)
   Test Mode: true
   âœ… Test mode enabled - XCM calls will be skipped
      âœ” should check test mode status (146ms)
    Contract Balance
   Contract Balance: 8.65 ETH
      âœ” should report contract balance
    Summary

============================================================
  AssetHubVault Configuration Summary
============================================================
Contract: 0x67E5293e374219C515bD9838B23C792C555e51D4
Admin: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
Operator: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
Emergency: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
XCM Precompile: 0x00000000000000000000000000000000000a0000
XCM Frozen: false
Paused: false
Test Mode: true
Balance: 8.65 ETH
============================================================

      âœ” should display configuration summary (231ms)

  AssetHubVault Testnet - Deposits & Withdrawals

âœ… Connected to vault at: 0x67E5293e374219C515bD9838B23C792C555e51D4
âœ… Network: passethub
âœ… User1 (tester): 0xE25d0513a9e15f847862cf5497836E80BBe67B63
âš ï¸  Using single user for all tests

    Deposit Functionality
   âœ“ Deposited 0.1 ETH
   âœ“ New balance: 5.9 ETH
      âœ” should accept deposits (TEST-AHV-007) (5519ms)
      âœ” should emit Deposit event (9478ms)
      âœ” should revert on zero deposit (TEST-AHV-008) (75ms)
      âœ” should handle multiple deposits from same user (11262ms)
      - should allow multiple users to deposit independently (TEST-AHV-009)
    Withdrawal Functionality
   âœ“ Withdrew 0.01 ETH
   âœ“ Remaining balance: 6.0 ETH
      âœ” should allow withdrawal if balance exists (TEST-AHV-010/011) (5513ms)
      âœ” should emit Withdraw event (29087ms)
      âœ” should revert on insufficient balance (TEST-AHV-012) (104ms)
      âœ” should revert on zero withdrawal (TEST-AHV-013) (79ms)
   âœ“ Withdrew full balance: 6.54 ETH
      âœ” should handle full balance withdrawal (23117ms)
    Balance Consistency
   âœ“ Balance consistency maintained
      Initial: 0.0 ETH
      Final: 0.5 ETH
      âœ” should maintain consistent balances across operations (31116ms)
      - should not affect other users' balances
    Contract State
   Contract balance: 3.45 ETH
      âœ” should update contract balance on deposits (11521ms)
   âœ“ Contract is operational
      âœ” should not be paused for deposits/withdrawals

  AssetHubVault Testnet - Investment Dispatch

âœ… Connected to vault at: 0x67E5293e374219C515bD9838B23C792C555e51D4
âœ… Network: passethub
âœ… Operator: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
âœ… Test Mode: Enabled (XCM calls will be skipped)

    Investment Dispatch - Basic Flow
   âœ“ Dispatched 0.5 ETH investment
   âœ“ User balance reduced to 1.1 ETH
   âœ“ Position confirmed and activated
      âœ” should allow operator to dispatch investment (TEST-AHV-016) (34483ms)
   âœ“ Amount: 0.5 ETH
   âœ“ Pool: 0x12345678...
   âœ“ Chain: 1287
   âœ“ Range: -50% to +50%
   âœ“ Status: Active (1)
      âœ” should create position with correct data (TEST-AHV-019) (151ms)
   âœ“ User now has 15 positions
      âœ” should update user positions array (TEST-AHV-020) (38544ms)
   âœ“ All 15 position IDs are unique
      âœ” should generate unique position IDs (TEST-AHV-018) (121ms)
    Investment Dispatch - Validation
      âœ” should revert on zero amount (TEST-AHV-017) (68ms)
      âœ” should revert on zero address user (TEST-AHV-017) (59ms)
      âœ” should revert on invalid range (TEST-AHV-017) (60ms)
      âœ” should revert on insufficient user balance (TEST-AHV-017) (93ms)
    Investment Dispatch - Test Mode Behavior
   XCM Precompile: 0x00000000000000000000000000000000000a0000
   âœ“ XCM Precompile: 0x00000000000000000000000000000000000a0000
   âœ“ Investment dispatched without XCM call (test mode)
   âœ“ Position confirmed and activated
      âœ” should skip XCM calls in test mode (TEST-AHV-022) (34496ms)
   âœ“ Position created successfully in test mode
   âœ“ Position status: Active
      âœ” should create position even without XCM (TEST-AHV-022) (34579ms)
    Investment Dispatch - Access Control
   âœ“ Operator confirmed: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
      âœ” should only allow operator to dispatch (if not operator role, skip)
      - should revert when paused (TEST-AHV-023)
    Investment Summary

   ğŸ“Š Investment Summary
   ==========================================
   Total Positions: 17
   Pending Positions: 1
   Active Positions: 10
   Liquidated Positions: 6
   ==========================================

   Active Positions (showing first 10):
   1. 0.5 ETH on chain 1287
   2. 0.2 ETH on chain 1287
   3. 0.1 ETH on chain 1287
   4. 0.1 ETH on chain 1287
   5. 0.1 ETH on chain 1287
   6. 0.1 ETH on chain 1287
   7. 0.5 ETH on chain 1287
   8. 0.2 ETH on chain 1287
   9. 0.1 ETH on chain 1287
   10. 0.1 ETH on chain 1287
   Total Active: 2.0 ETH
   ==========================================

      âœ” should display all user positions (94ms)

  AssetHubVault Testnet - Liquidation Settlement

âœ… Connected to vault at: 0x67E5293e374219C515bD9838B23C792C555e51D4
âœ… Network: passethub
âœ… Operator: 0xE25d0513a9e15f847862cf5497836E80BBe67B63

    Liquidation Settlement - Basic Flow
   âœ“ Position settled successfully
   âœ“ Invested: 0.5 ETH
   âœ“ Proceeds: 0.6 ETH
   âœ“ Profit: 0.1 ETH (20.00%)
   âœ“ Position marked as liquidated
   âœ“ User balance increased
      âœ” should allow operator to settle liquidation (TEST-AHV-024) (63611ms)
   âœ“ Successfully withdrew 0.1 ETH after settlement
      âœ” should allow user to withdraw after settlement (TEST-AHV-027) (11451ms)
    Liquidation Settlement - Validation
      âœ” should revert on zero amount (TEST-AHV-025) (34614ms)
   âœ“ Cannot settle inactive position (TEST-AHV-026)
      âœ” should revert on inactive position (TEST-AHV-025) (69692ms)
      âœ” should revert on insufficient contract balance (TEST-AHV-025) (26049ms)
    Liquidation Settlement - Position State

   ğŸ“Š Position State Summary
   Total Positions: 21
   Pending: 2
   Active: 11
   Liquidated: 8
   Sample (1 positions): 0.5 ETH
   ==========================================

      âœ” should track settled positions correctly (79ms)
   âœ“ Position data preserved after settlement
   âœ“ Status changed from Active (1) to Liquidated (2)
      âœ” should maintain position data after settlement (65488ms)
    Liquidation Settlement - User Balance
   âœ“ Net balance change: 0.55 ETH
   âœ“ (Deposit + Proceeds - Investment)
      âœ” should correctly credit proceeds to user balance (76586ms)
    Liquidation Summary

   ğŸ“Š Liquidation Test Summary
   ==========================================
   Total Positions Created: 23
   Pending Positions: 2
   Active Positions: 11
   Liquidated Positions: 10
   User Withdrawable Balance: 4.85 ETH
   Contract Total Balance: 10.2 ETH

   Recent Liquidations (showing 5):
   1. 0.5 ETH on chain 1287
   2. 0.2 ETH on chain 1287
   3. 0.2 ETH on chain 1287
   4. 0.3 ETH on chain 1287
   5. 0.3 ETH on chain 1287
   ==========================================

      âœ” should display complete liquidation history (233ms)

  AssetHubVault Testnet - Emergency Functions

âœ… Connected to vault at: 0x67E5293e374219C515bD9838B23C792C555e51D4
âœ… Network: passethub
âœ… Admin/Emergency: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
   Contract admin: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
   Contract emergency: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
   âœ… Test account has admin/emergency privileges

    Emergency Liquidation
   âœ“ Emergency liquidation successful
   âœ“ Funds credited: 0.2 ETH
      âœ” should allow emergency to force liquidate position (TEST-AHV-029) (50244ms)
   âœ“ Rejects emergency liquidation with wrong chainId
      âœ” should validate chainId on emergency liquidation (TEST-AHV-030) (34591ms)
   âœ“ Cannot emergency liquidate already-liquidated position (TEST-AHV-031)
      âœ” should only work on non-liquidated positions (TEST-AHV-031) (49985ms)
    Pause/Unpause Functions
   âœ“ Contract paused successfully
   âœ“ Contract unpaused successfully
      âœ” should allow admin to pause contract (TEST-AHV-032) (27013ms)
   âœ“ dispatchInvestment blocked while paused
   âœ“ Contract unpaused - normal operations restored
      âœ” should block operations when paused (TEST-AHV-033) (27111ms)
   Initial paused state: false
   âœ“ Contract paused - paused state: true
   âœ“ Contract unpaused - paused state: false
      âœ” should verify pause state changes (27111ms)
    Emergency Summary

   ğŸ“Š Emergency Functions Summary
   ==========================================
   Admin Address: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
   Emergency Address: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
   Test Account: 0xE25d0513a9e15f847862cf5497836E80BBe67B63
   Has Admin Rights: YES
   Has Emergency Rights: YES
   ==========================================
   Contract State:
   - Paused: NO âœ…
   - Test Mode: YES âœ…
   - Total Positions: 26
   - Pending Positions: 2
   - Active Positions: 12
   - Liquidated Positions: 12
   ==========================================

      âœ” should display emergency capabilities and current state (277ms)


  51 passing (14m)
  3 pending

